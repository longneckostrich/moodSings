<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mood-Based Playlist Generator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <div class="d-flex flex-column justify-content-center align-items-center min-vh-100 gap-3">
    <h1>Select Your Mood</h1>

    <!-- Dropdown and button -->
    <div class="d-flex align-items-center gap-3">
      <select id="moodSelect" class="form-select">
        <option value="happy">Happy</option>
        <option value="sad">Sad</option>
        <option value="energetic">Energetic</option>
        <option value="relaxed">Relaxed</option>
      </select>
      <button onclick="getPlaylist()" type="button" class="btn btn-primary">Get Playlist</button>
    </div>

    <div id="playlist" class="mt-4"></div>
  </div>

  <!-- Bootstrap Bundle JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const CLIENT_ID = 'e22b5e00b4ad4d72a6bde0c76f8a6e79';
    const REDIRECT_URI = 'https://longneckostrich.github.io/moodSings/';
    const AUTH_ENDPOINT = 'https://accounts.spotify.com/authorize';
    const RESPONSE_TYPE = 'token';

    let token = null;

    // Extract access token from URL hash
    const hash = window.location.hash;
    if (hash) {
      const tokenMatch = hash.match(/access_token=([^&]*)/);
      if (tokenMatch) {
        token = tokenMatch[1];
        window.location.hash = ""; // Remove the token from the URL
      }
    }

    // Function to authenticate with Spotify
    function authenticateSpotify() {
      const authUrl = `${AUTH_ENDPOINT}?client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}&response_type=${RESPONSE_TYPE}&scope=playlist-read-private`;
      window.location = authUrl;
    }

    // Function to get the playlist
  async function getPlaylist() {
    if (!token) {
      authenticateSpotify();
      return;
    }

    const mood = document.getElementById('moodSelect').value;
    try {
      // Fetch playlists related to the selected mood
      const response = await fetch(`https://api.spotify.com/v1/search?q=${mood}&type=playlist&limit=1`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      const data = await response.json();

      // Check if playlists were found
      if (data.playlists && data.playlists.items.length > 0) {
        const playlist = data.playlists.items[0];
        const playlistImage = playlist.images[0]?.url || 'https://via.placeholder.com/150'; // Use a placeholder if no image is available

        // Display playlist information with the cover image
        document.getElementById("playlist").innerHTML = `
          <div class="text-center">
            <h3>${playlist.name}</h3>
            <img src="${playlistImage}" alt="Playlist Cover" class="img-fluid" style="max-width: 300px; border-radius: 10px;">
            <br>
            <a href="${playlist.external_urls.spotify}" target="_blank" class="btn btn-success mt-3">Open Playlist</a>
          </div>
        `;
      } else {
        document.getElementById("playlist").textContent = "No playlists found.";
      }
    } catch (error) {
      console.error('Error fetching playlist:', error);
      document.getElementById("playlist").textContent = "Failed to fetch playlist.";
    }
  }
  </script>
</body>
</html>
